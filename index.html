<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Selector Demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet">
    <style>
        .highlight {
            background-color: #ffeb3b !important;
            border: 2px solid #ff9800 !important;
        }
        .demo-section {
            margin-bottom: 2rem;
        }
        .output {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 0.375rem;
            padding: 1rem;
            font-family: 'Courier New', monospace;
        }
        .demo-element {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .demo-element:hover {
            background-color: #e9ecef;
        }
        .clicked {
            background-color: #d1ecf1;
            border-color: #bee5eb;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <div class="row">
            <div class="col-md-8 mx-auto">
                <h1 class="text-center mb-4">Smart Selector Demo</h1>
                <p class="text-center text-muted">
                    A TypeScript library for generating unique CSS selectors from DOM elements
                </p>

                <div class="demo-section">
                    <h3>Interactive Demo</h3>
                    <p>Click on any element below to see its unique CSS selector:</p>
                    
                    <div class="card mb-3">
                        <div class="card-body">
                            <div id="unique-element" class="demo-element p-2 mb-2 border rounded">
                                <h5 id="title-element">Element with ID</h5>
                                <p class="text-muted">This element has a unique ID</p>
                            </div>
                            
                            <div class="demo-element p-2 mb-2 border rounded class-example primary">
                                <strong>Element with Classes</strong>
                                <span class="badge bg-primary">Badge</span>
                            </div>
                            
                            <div class="demo-element p-2 mb-2 border rounded" data-test="attribute-example">
                                <em>Element with Custom Attribute</em>
                                <small class="text-muted d-block">Has data-test attribute</small>
                            </div>
                            
                            <div class="demo-element p-2 mb-2 border rounded">
                                <div class="d-flex">
                                    <div class="flex-grow-1">
                                        <span class="demo-element">Nested Element</span>
                                    </div>
                                    <div>
                                        <button class="btn btn-sm btn-outline-primary demo-element">Button</button>
                                    </div>
                                </div>
                            </div>
                            
                            <ul class="list-group">
                                <li class="list-group-item demo-element">List Item 1</li>
                                <li class="list-group-item demo-element">List Item 2</li>
                                <li class="list-group-item demo-element">List Item 3</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="alert alert-info">
                        <strong>Selected Element:</strong>
                        <div id="selected-element" class="mt-2">Click on an element above</div>
                    </div>
                    
                    <div class="alert alert-success">
                        <strong>Generated Selector:</strong>
                        <code id="generated-selector">-</code>
                    </div>
                </div>

                <div class="demo-section">
                    <h3>Configuration Options</h3>
                    <div class="card">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <h5>Selector Types</h5>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="ID" id="type-id" checked>
                                        <label class="form-check-label" for="type-id">ID</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="Class" id="type-class" checked>
                                        <label class="form-check-label" for="type-class">Class</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="Tag" id="type-tag" checked>
                                        <label class="form-check-label" for="type-tag">Tag</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="NthChild" id="type-nth" checked>
                                        <label class="form-check-label" for="type-nth">NthChild</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="Attributes" id="type-attr">
                                        <label class="form-check-label" for="type-attr">Attributes</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <h5>Exclude Regex</h5>
                                    <input type="text" class="form-control" id="exclude-regex" placeholder="e.g., ^temp-">
                                    <small class="text-muted">Regular expression to exclude certain selectors</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="demo-section">
                    <h3>Usage Example</h3>
                    <pre><code class="language-typescript">import smartSelector from 'smart-selector';

// Basic usage
const element = document.querySelector('#my-element');
const selector = smartSelector(element);
console.log(selector); // "#my-element"

// With options
const options = {
  selectorTypes: ['ID', 'Class', 'Tag'],
  excludeRegex: /^temp-/
};
const selector = smartSelector(element, options);</code></pre>
                </div>

                <div class="demo-section">
                    <h3>Features</h3>
                    <div class="row">
                        <div class="col-md-6">
                            <ul class="list-group">
                                <li class="list-group-item">
                                    <i class="fas fa-check-circle text-success me-2"></i>
                                    TypeScript Support
                                </li>
                                <li class="list-group-item">
                                    <i class="fas fa-check-circle text-success me-2"></i>
                                    Multiple Selector Types
                                </li>
                                <li class="list-group-item">
                                    <i class="fas fa-check-circle text-success me-2"></i>
                                    Configurable Options
                                </li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <ul class="list-group">
                                <li class="list-group-item">
                                    <i class="fas fa-check-circle text-success me-2"></i>
                                    Modern Build System
                                </li>
                                <li class="list-group-item">
                                    <i class="fas fa-check-circle text-success me-2"></i>
                                    Comprehensive Tests
                                </li>
                                <li class="list-group-item">
                                    <i class="fas fa-check-circle text-success me-2"></i>
                                    Browser Compatible
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-typescript.min.js"></script>
    <script type="module">
        // Import the library (in a real scenario, this would come from npm)
        // For demo purposes, we'll implement a simplified version
        
        function isElement(element) {
            return element instanceof Element;
        }

        function getID(element) {
            const id = element.getAttribute('id');
            if (!id) return null;
            return `#${id}`;
        }

        function getClassSelectors(element) {
            const className = element.getAttribute('class');
            if (!className) return [];
            return className.trim().split(/\s+/).filter(cls => cls.length > 0).map(cls => `.${cls}`);
        }

        function getTag(element) {
            return element.tagName.toLowerCase();
        }

        function getNthChild(element) {
            const parent = element.parentElement;
            if (!parent) return null;
            const children = Array.from(parent.children);
            const index = children.indexOf(element);
            return index !== -1 ? `:nth-child(${index + 1})` : null;
        }

        function getAttributes(element, attributesToIgnore = []) {
            const attributes = [];
            for (let i = 0; i < element.attributes.length; i++) {
                const attr = element.attributes[i];
                if (!attributesToIgnore.includes(attr.name)) {
                    attributes.push(`[${attr.name}="${attr.value}"]`);
                }
            }
            return attributes;
        }

        function isUnique(element, selector) {
            if (!selector) return false;
            try {
                const elements = element.ownerDocument.querySelectorAll(selector);
                return elements.length === 1 && elements[0] === element;
            } catch (error) {
                return false;
            }
        }

        function smartSelector(element, options = {}) {
            if (!isElement(element)) {
                throw new Error('First argument must be a DOM element');
            }

            const {
                selectorTypes = ['ID', 'Class', 'Tag', 'NthChild'],
                attributesToIgnore = ['id', 'class', 'length'],
                excludeRegex = null
            } = options;

            // Try ID first
            if (selectorTypes.includes('ID')) {
                const id = getID(element);
                if (id && (!excludeRegex || !excludeRegex.test(id)) && isUnique(element, id)) {
                    return id;
                }
            }

            // Try classes
            if (selectorTypes.includes('Class')) {
                const classes = getClassSelectors(element);
                if (classes.length > 0) {
                    let filteredClasses = classes;
                    if (excludeRegex) {
                        filteredClasses = classes.filter(cls => !excludeRegex.test(cls));
                    }
                    const classSelector = filteredClasses.join('');
                    if (classSelector && isUnique(element, classSelector)) {
                        return classSelector;
                    }
                }
            }

            // Try tag
            if (selectorTypes.includes('Tag')) {
                const tag = getTag(element);
                if (tag && isUnique(element, tag)) {
                    return tag;
                }
            }

            // Try attributes
            if (selectorTypes.includes('Attributes')) {
                const attributes = getAttributes(element, attributesToIgnore);
                for (const attr of attributes) {
                    if (isUnique(element, attr)) {
                        return attr;
                    }
                }
            }

            // Try nth-child
            if (selectorTypes.includes('NthChild')) {
                const nthChild = getNthChild(element);
                if (nthChild) {
                    const tag = getTag(element);
                    const selector = tag + nthChild;
                    if (isUnique(element, selector)) {
                        return selector;
                    }
                }
            }

            // Fallback to more complex selectors
            const tag = getTag(element);
            const nthChild = getNthChild(element);
            if (tag && nthChild) {
                return tag + nthChild;
            }

            return '*';
        }

        // Demo functionality
        let currentElement = null;

        function updateSelector() {
            if (!currentElement) return;

            const selectedTypes = Array.from(document.querySelectorAll('input[type="checkbox"]:checked'))
                .map(cb => cb.value);
            
            const excludeRegexInput = document.getElementById('exclude-regex').value;
            let excludeRegex = null;
            if (excludeRegexInput) {
                try {
                    excludeRegex = new RegExp(excludeRegexInput);
                } catch (e) {
                    console.warn('Invalid regex:', excludeRegexInput);
                }
            }

            const options = {
                selectorTypes: selectedTypes,
                excludeRegex: excludeRegex
            };

            try {
                const selector = smartSelector(currentElement, options);
                document.getElementById('generated-selector').textContent = selector;
            } catch (error) {
                document.getElementById('generated-selector').textContent = 'Error: ' + error.message;
            }
        }

        // Add click handlers
        document.addEventListener('click', (event) => {
            if (event.target.classList.contains('demo-element')) {
                event.preventDefault();
                
                // Remove previous highlight
                document.querySelectorAll('.highlight').forEach(el => el.classList.remove('highlight'));
                
                // Highlight current element
                event.target.classList.add('highlight');
                currentElement = event.target;
                
                // Update display
                document.getElementById('selected-element').textContent = 
                    `<${event.target.tagName.toLowerCase()}>${event.target.textContent.trim().substring(0, 50)}...`;
                
                updateSelector();
            }
        });

        // Add change handlers for options
        document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', updateSelector);
        });

        document.getElementById('exclude-regex').addEventListener('input', updateSelector);

        // Initialize
        console.log('Smart Selector Demo loaded');
    </script>
</body>
</html>
